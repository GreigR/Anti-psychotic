---
title: "Anti-psychotic drug analysis"
author: "Dr Greig Russell"
date: "2 March 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

#Anti-psychotic drug analysis

This analysis describes the anti-psychotic usage of 100 patients from the mental health service. It will describe the characteristics of the sample and the anti-psychotic medication presecribed for them. This description will provide the base to understand the relationships between anti-psychotic presecriptions and features of the population.

##Summary

```{r load_the_libraries, warning=FALSE, message=FALSE}
# Load the tidyverse
library(tidyverse)

# Load any axillary libraries
library(nullabor)
library(car)
```

```{r load_the_data, warning=FALSE, message=FALSE}
Drug <- read.csv("/home/greig/R-projects/Clinical_audits/Drug/Anti-psychotic/Drug.csv", na.strings = "")

Drug <- Drug %>% 
  rename(Drug1_NZFpercentage = Drug1_NZFpercentage.)
```

```{r basic_demographic_data, warning=FALSE, message=FALSE}
summary(Drug)
```


##Sample demographics

###Age distribution
```{r age1, warning=FALSE, message=FALSE}
ggplot(data = Drug) +
  geom_density(aes(x = Age), fill = "red") +
  labs(title = "Density plot of cohort age") +
  theme_minimal()
```


###Gender
```{r gender1, warning=FALSE, message=FALSE}
Drug %>% 
  group_by(Gender) %>% 
  summarise(Count = n()) %>% 
  ggplot(aes(x = Gender, y = Count, fill = Gender)) +
  geom_col() +
  labs(title = "Gender distribution") +
  theme_minimal()
```

###Age by age
```{r gender2, warning=FALSE, message=FALSE}
ggplot(data = Drug) +
  geom_boxplot(aes(x = Gender, y = Age, fill = Gender)) +
  labs(title = "Boxplot of cohort age by gender") +
  theme_minimal()
```

###Total regular anti-psychotic dosage by number of drug types
```{r Drug1, warning=FALSE, message=FALSE}
Poly <- Drug %>% 
  filter(Poly_Num_drugs < 4)
Poly$Poly_Num_drugs <- as.factor(Poly$Poly_Num_drugs)
```


```{r Drug2, warning=FALSE, message=FALSE}
ggplot(data = Poly) +
  geom_boxplot(aes(x = Poly_Num_drugs, y = Poly_sum_reg_NZFpercentage, fill = Poly_Num_drugs)) +
  labs(title = "Total dosage of presecribed anti-psychotic by number of drug types used") +
  theme_minimal()
```


Prior to testing for significance by ANOVA, Levene test performed to conform homogenity of variance
```{r levene1, warning=FALSE, message=FALSE}
#Levene test

leveneTest(Poly$Poly_sum_reg_NZFpercentage, Poly$Poly_Num_drugs, center = mean)
```


####ANOVA test

```{r anova1, warning=FALSE, message=FALSE}
Model1 <- aov(Poly_sum_reg_NZFpercentage ~ Poly_Num_drugs, data = Poly)
summary(Model1)
```

Supporting the hypothesis that the number of drug types presecribed is significantly positively correlated with the total dosage of anti-psychotics received per day.


###Total regular anti-psychotic dosage by gender
```{r gender1a, warning=FALSE, message=FALSE}
ggplot(data = Poly) +
  geom_boxplot(aes(x = Gender, y = Poly_sum_reg_NZFpercentage, fill = Gender)) +
  labs(title = "Total dosage of presecribed anti-psychotic by gender of the client") +
  theme_minimal()
```

Again testing for the homogenity of the variance;
```{r gender2a, message=FALSE, warning=FALSE}
# Levene test

leveneTest(Poly$Poly_sum_reg_NZFpercentage, Poly$Gender, center = mean)

```

```{r gender3, message=FALSE, warning=FALSE}
Model2 <- aov(Poly_sum_reg_NZFpercentage ~ Gender, data = Poly)
summary(Model2)
```

###Relationship between drug levels during inpatient and on discharge
```{r discharge1, warning=FALSE, message=FALSE}
ggplot(data = Poly, aes(x = Poly_sum_reg_NZFpercentage, y = Discharge_Reg_NZF_Percentage)) +
  geom_point() +
  geom_smooth() +
  labs(Title = "Relationship between inpatient drug levels and those following discharge")
```

```{r discgarge2, warning=FALSE, message=FALSE}
Model3 <- lm(Discharge_Reg_NZF_Percentage ~ Poly_sum_reg_NZFpercentage, data = Poly)
summary(Model3)
plot(Model3)
plot(residuals(Model3))
```

